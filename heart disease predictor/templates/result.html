<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prediction Result</title>
    <style>
        body { margin:0; font-family:'Segoe UI',Arial,sans-serif; background:linear-gradient(135deg,#232526,#414345); color:#f5f5f5; min-height:100vh; display:flex; align-items:center; justify-content:center; }
        .wrapper { background:rgba(34,40,49,0.9); padding:50px 40px; border-radius:24px; max-width:520px; width:100%; box-shadow:0 10px 40px rgba(0,0,0,0.4); position:relative; }
        h1 { margin-top:0; font-size:2rem; letter-spacing:1px; text-align:center; color:#00adb5; }
    .result-box { margin-top:25px; padding:25px 20px; border-radius:18px; background:#393e46; display:flex; flex-direction:column; gap:14px; border:2px solid #00adb5; }
    .probability { text-align:center; font-size:0.95rem; }
    .risk-bar-wrapper { background:#222831; border-radius:10px; height:16px; overflow:hidden; }
    .risk-bar { height:100%; width:0; transition:width .8s ease; background:linear-gradient(90deg,#4caf50,#f8d90f,#ff6363); }
    .gauge-wrapper { margin:18px auto 4px auto; width:140px; height:140px; position:relative; }
    .gauge-wrapper svg { transform:rotate(-90deg); width:140px; height:140px; }
    .gauge-bg { stroke:#222831; stroke-width:14; fill:none; }
    .gauge-value { stroke:url(#grad); stroke-width:14; stroke-linecap:round; fill:none; stroke-dasharray:0 999; transition:stroke-dasharray 1s ease; }
    .gauge-center { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center; }
    .gauge-center .pct { font-size:1.2rem; font-weight:700; }
    .advice { margin-top:12px; font-size:0.8rem; line-height:1.35; background:#222831; padding:12px 14px; border-left:4px solid #00adb5; border-radius:10px; }
    .advice.low { border-color:#4caf50; }
    .advice.moderate { border-color:#f8d90f; }
    .advice.high { border-color:#ff6363; }
    .gauge-label { font-size:0.6rem; letter-spacing:0.5px; opacity:0.75; }
    .mini-note { margin-top:6px; font-size:0.65rem; opacity:0.65; }
    .importance { margin-top:10px; font-size:0.8rem; background:#222831; padding:10px 12px; border-radius:10px; }
    .importance h3 { margin:0 0 6px 0; font-size:0.85rem; color:#00adb5; text-align:center; }
    .importance table { width:100%; border-collapse:collapse; }
    .importance th, .importance td { padding:4px 6px; text-align:left; }
    .importance th { font-size:0.7rem; text-transform:uppercase; letter-spacing:0.5px; }
    .importance tr:nth-child(even){ background:#1d2227; }
        .status { font-size:1.4rem; font-weight:700; text-align:center; }
        .status.positive { color:#ff6363; }
        .status.negative { color:#4caf50; }
        .inputs { font-size:0.95rem; line-height:1.5; background:#222831; padding:14px 16px; border-radius:12px; }
        .inputs span { color:#00adb5; }
        a.button { margin-top:28px; display:inline-block; text-decoration:none; background:linear-gradient(90deg,#00adb5,#4caf50); color:#fff; padding:12px 26px; font-weight:600; border-radius:10px; transition:opacity .2s; }
        a.button:hover { opacity:.85; }
        .badge { position:absolute; top:-14px; right:-14px; background:linear-gradient(135deg,#f8d90f,#ff8c42); color:#222; font-weight:700; padding:8px 14px; border-radius:14px; font-size:0.8rem; box-shadow:0 4px 14px rgba(0,0,0,.35); }
        .note { margin-top:18px; font-size:0.75rem; color:#b0b0b0; text-align:center; }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="badge">Result</div>
        <h1>Your Prediction</h1>
        <div class="result-box">
            {% if result %}
                <div class="status {{ 'positive' if result == 'Heart Disease Detected' else 'negative' }}">{{ result }}</div>
            {% else %}
                <div class="status">No result available.</div>
            {% endif %}
            {% if probability is not none %}
            <div class="probability">
                <strong>Probability (model):</strong> {{ (probability * 100) | round(1) }}% &mdash; Risk Level: <b>{{ risk_level }}</b>
                <div class="risk-bar-wrapper" aria-label="Risk visualization (bar)">
                    <div class="risk-bar" id="riskBar"></div>
                </div>
                <!-- Circular Gauge -->
                <div class="gauge-wrapper" aria-label="Risk circular gauge">
                    <svg viewBox="0 0 120 120">
                        <defs>
                            <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#4caf50"/>
                                <stop offset="50%" stop-color="#f8d90f"/>
                                <stop offset="100%" stop-color="#ff6363"/>
                            </linearGradient>
                        </defs>
                        <circle class="gauge-bg" cx="60" cy="60" r="50" />
                        <circle class="gauge-value" id="gaugeValue" cx="60" cy="60" r="50" />
                    </svg>
                    <div class="gauge-center">
                        <div class="pct" id="gaugePct">0%</div>
                        <div class="gauge-label">RISK</div>
                    </div>
                </div>
            </div>
            {% if probability is not none %}
            <div class="advice {{ risk_level|lower }}">
                {% if risk_level == 'Low' %}
                    Maintain a healthy lifestyle: balanced diet, regular exercise, and routine check-ups.
                {% elif risk_level == 'Moderate' %}
                    Consider consulting a healthcare professional for a preventive evaluation and lifestyle adjustments.
                {% else %}
                    Elevated risk: strongly consider medical consultation for further diagnostic testing and management.
                {% endif %}
                <div class="mini-note">Not a medical diagnosis.</div>
            </div>
            {% endif %}
            {% endif %}
            {% if inputs %}
            <div class="inputs">
                <strong>Entered Values:</strong><br>
                Age: <span>{{ inputs.age }}</span><br>
                Chest Pain Type (cp): <span>{{ inputs.cp }}</span><br>
                Max Heart Rate (thalach): <span>{{ inputs.thalach }}</span>
            </div>
            {% endif %}
            {% if importance %}
            <div class="importance">
                <h3>Feature Impact (log-odds)</h3>
                <table>
                    <thead><tr><th>Feature</th><th>Val</th><th>Coef</th><th>Contr</th></tr></thead>
                    <tbody>
                        {% for item in importance %}
                        <tr>
                            <td>{{ item.feature }}</td>
                            <td>{{ item.value }}</td>
                            <td>{{ '%.3f'|format(item.coefficient) }}</td>
                            <td>{{ '%.3f'|format(item.contribution) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>
        <a class="button" href="{{ url_for('home') }}">&#8592; New Prediction</a>
        <div class="note">This tool is for educational/demo purposes only and not a medical diagnosis.</div>
    </div>
</body>
</html>
<script>
    // Animate risk bar after load
    // Injected probability from server
    const prob = JSON.parse('{{ (probability if probability is not none else 0)|tojson }}');
    const bar = document.getElementById('riskBar');
    if(bar){
        requestAnimationFrame(()=>{ bar.style.width = (prob*100).toFixed(1) + '%'; });
    }
    // Circular gauge animation
    const circle = document.getElementById('gaugeValue');
    const pctLabel = document.getElementById('gaugePct');
    if(circle){
        const r = 50;
        const circumference = 2 * Math.PI * r;
        circle.style.strokeDasharray = `0 ${circumference}`;
        const target = prob; // 0-1
        let current = 0;
        const step = () => {
            current += (target - current) * 0.12;
            if(Math.abs(current - target) < 0.002) current = target;
            const filled = circumference * current;
            circle.style.strokeDasharray = `${filled} ${circumference - filled}`;
            if(pctLabel) pctLabel.textContent = (current*100).toFixed(1)+"%";
            if(current !== target) requestAnimationFrame(step);
        };
        requestAnimationFrame(step);
    }
</script>
